from deepeval.synthesizer.config import StylingConfig, ContextConstructionConfig
from deepeval.dataset import EvaluationDataset, Golden, ConversationalGolden
from deepeval.test_case import ConversationalTestCase, LLMTestCase
from deepeval.synthesizer import Synthesizer


## Synthesizer
styling_config = StylingConfig(
    expected_output_format="Ensure the output mimics a medical chatbot attempting to diagnose a patient's illness. It should either ask additional questions if the information provided is insufficient or make a diagnosis if the input is comprehensive",
    input_format="Ensure the input reflects what a sick person might say or ask a medical chatbot when seeking a diagnosis.",
    task="The chatbot serves as an expert in medical diagnosis, integrated with a patient booking system. It performs tasks sequentially to ensure accurate and efficient appointment management and diagnosis.",
    scenario="Non-medical patients describing symptoms to seek a diagnosis",
)
context_config = ContextConstructionConfig(max_contexts_per_document=10)
synthesizer = Synthesizer(styling_config=styling_config)

conversation = [
    {
        "input": "I’ve been feeling fatigued and experiencing mild headaches for the past few days. Can I also know the available appointment slots for the next two days?",
        "response": "Let's start by creating an appointment and recording your symptoms. Could you please provide more specific details about your symptoms? For example, are you experiencing any other symptoms like dizziness, nausea, or changes in vision? Also, do you have any known medical conditions or are you taking any medications? Once I have more details, I'll proceed with the diagnosis and check the available appointment slots for you."
    },
    {
        "input": "I have been feeling fatigued and experiencing mild headaches for the past few days. Occasionally, I feel a bit dizzy, especially when standing up quickly. While there’s no nausea, I have noticed slight blurriness in my vision when the headache intensifies. I don’t have any known medical conditions, although I have experienced occasional migraines in the past. Currently, I am not taking any medications. Let me know if you need additional details!",
        "response": "Your symptoms have been recorded, and a preliminary diagnosis suggests that they may be related to migraines, especially given your history. It's recommended to consult a healthcare professional for a thorough evaluation and to discuss potential preventive treatments. Could you please provide your name, the date you would like the appointment, and your email address so I can finalize the appointment details for you?"
    },
]
turns = [
  LLMTestCase(
    input=turn["input"],
    actual_output=turn["response"]
  )
  for turn in conversation
]
dataset = EvaluationDataset(test_cases=[ConversationalTestCase(turns=turns)])



# dataset.generate_goldens_from_docs(
#     max_goldens_per_context=1,
#     document_paths=["./synthesizer_data/encyclopedia.pdf"],
#     context_construction_config=context_config,
#     synthesizer=synthesizer,
# )


# Push
# dataset = EvaluationDataset(
#     goldens=[
#         Golden(
#             input="I've been having recurring ear infections and nasal congestion. Could this be due to something like enlarged adenoids obstructing my Eustachian tube?",
#             actual_output=None,
#             expected_output="Based on your symptoms of recurring ear infections and nasal congestion, it's possible that enlarged adenoids could be obstructing your Eustachian tube. This can prevent proper air pressure equalization in the ear, leading to infections. To confirm this diagnosis, a medical examination using a small mirror or fiberoptic scope to view the adenoids would be necessary. Additionally, a throat culture or mononucleosis test may help identify any underlying infections. Please consult a healthcare professional for a thorough evaluation.",
#             context=[
#                 "Adenoid hyperplasia\nDefinition\nAdenoid hyperplasia is the overenlargement of the\nlymph glands located above the back of the mouth.\nDescription\nLocated at the back of the mouth above and below\nthe soft palate are two pairs of lymph glands. The tonsilsbelow are clearly visible behind the back teeth; the ade-noids lie just above them and are hidden from view by thepalate. Together these four arsenals of immune defenseguard the major entrance to the body from foreigninvaders—the germs we breathe and eat. In contrast to therest of the body’s tissues, lymphoid tissue reaches itsgreatest size in mid-childhood and recedes thereafter. Inthis way children are best able to develop the immunitiesthey need to survive in a world full of infectious diseases.\nBeyond its normal growth pattern, lymphoid tissue\ngrows excessively (hypertrophies) during an acute infec-tion, as it suddenly increases its immune activity to fightoff the invaders. Often it does not completely return to itsformer size. Each subsequent infection leaves behind alarger set of tonsils and adenoids. To make mattersworse, the sponge-like structure of these hypertrophiedglands can produce safe havens for germs where thebody cannot reach and eliminate them. Before antibi-\notics and the reduction in infectious childhood diseases\nover the past few generations, tonsils and adenoidscaused greater health problems.\nCauses and symptoms\nMost tonsil and adenoid hypertrophy is simply\ncaused by the normal growth pattern for that type of tis-sue. Less often, the hypertrophy is due to repeated throatinfections by cold viruses, strep throat , mononucleosis,\nand in times gone by, diphtheria . The acute infections\nare usually referred to as tonsillitis , the adenoids getting\nlittle recognition because they cannot be seen withoutspecial instruments. Symptoms include painful, brightred, often ulcerated tonsils, enlargement of lymph nodes(glands) beneath the jaw, fever , and general discomfort.\nAfter the acute infection subsides, symptoms are gen-\nerated simply by the size of the glands. Extremely largetonsils can impair breathing and swallowing, although thatis quite rare. Large adenoids can impair nose breathingand require a child to breathe through the mouth. Becausethey encircle the only connection between the middle earand the eustachian tube, hypertrophied adenoids can alsoobstruct it and cause middle ear infections.KEY TERMS\nEustacian tube —A tube connecting the middle ear\nwith the back of the nose, allowing air pressure toequalize within the ear whenever it opens, such aswith yawning.\nHyperplastic —Overgrown.\nHypertrophy —Overgrowth.\nStrep throat —An infection of the throat caused by\nbacteria of the Streptococcus family, which causes\ntonsillitis.\nUlcerated —Damaged so that the surface tissue is\nlost and/or necrotic (dead).\nDiagnosis\nA simple tongue blade depressing the tongue allows\nan adequate view of the tonsils. Enlarged tonsils mayhave deep pockets (crypts) containing dead tissue(necrotic debris). Viewing adenoids requires a small mir-ror or fiberoptic scope. A child with recurring middle earinfections may well have large adenoids. A throat cul-\nture or mononucleosis test will usually reveal the identi-\nty of the germ.\nTreatment\nIt used to be standard practice to remove tonsils\nand/or adenoids after a few episodes of acute throat or earinfection. The surgery is called tonsillectomy and ade-\nnoidectomy (T and A). Opinion changed as it was realized\nthat this tissue is beneficial to the development of immuni-ty. For instance, children without tonsils and adenoids pro-duce only half the immunity to oral polio vaccine. In addi-\ntion, treatment of ear and throat infections with antibioticsand of recurring ear infections with surgical drainagethrough the ear drum (tympanostomy) has greatly reducedthe incidence of surgical removal of these lymph glands.\nAlternative treatment\nThere are many botanical/herbal remedies that can\nbe used alone or in formulas to locally assist the tonsilsand adenoids in their immune function at the opening ofthe oral cavity and to tone these glands. Keeping theEustachian tubes open is an important contribution tooptimal function in the tonsils and adenoids. Food aller-\ngies are often the culprits for recurring ear infections, as\nwell as tonsilitis and adenoiditis. Identification andremoval of the allergic food"
#             ],
#             retrieval_context=None,
#             additional_metadata={
#                 "evolutions": ["Constrained"],
#                 "synthetic_input_quality": 0.7,
#                 "context_quality": 0.875,
#             },
#             comments=None,
#             tools_called=None,
#             expected_tools=None,
#             source_file="./synthesizer_data/encyclopedia.pdf",
#         ),
#         Golden(
#             input="I am pregnant and experiencing abdominal pain. What could be causing this, and should I get an abdominal ultrasound?",
#             actual_output=None,
#             expected_output="As a medical chatbot, I suggest that you consult with your healthcare provider regarding your abdominal pain, especially since you are pregnant. It is crucial to consider whether an abdominal ultrasound is appropriate in your situation because a fetus in the early stages of development could potentially be harmed by ultrasound meant to probe deeply recessed abdominal organs. Can you provide more details about the nature and severity of your pain, and whether it is accompanied by other symptoms, such as fever or bleeding? This information will help determine the urgency and type of medical attention needed.",
#             context=[
#                 "under most types of major medical insurance. As always,\nthough, the patient would be wise to confirm that theircoverage extends to the specific procedure proposed. Fornonemergency situations, most underwriters stipulateprior approval as a condition of coverage.\nSpecific conditions for which ultrasound may be\nselected as a treatment option—certain types of tumors,lesions, kidney stones and other calculi, muscle and lig-\nament injuries, etc.—are described in detail under theappropriate entries in this encyclopedia.\nPreparation\nA patient undergoing abdominal ultrasound will be\nadvised by their physician about what to expect and howto prepare. As mentioned above, preparations generallyinclude fasting and arriving for the procedure with a fullbladder, if necessary. This preparation is particularly use-ful if the gallbladder, ovaries or veins are to be examined.\nAftercare\nIn general, no aftercare related to the abdominal\nultrasound procedure itself is required.\nRisks\nAbdominal ultrasound carries with it no recognized\nrisks or side effects, if properly performed using appropri-ate frequency and intensity ranges. Sensitive tissues, par-ticularly those of the reproductive organs, could possiblysustain damage if violently vibrated by overly intenseultrasound waves. In general though, such damage wouldonly result from improper use of the equipment.\nAny woman who thinks she might be pregnant\nshould raise this issue with her doctor before undergoingan abdominal ultrasound, as a fetus in the early stages ofdevelopment could be injured by ultrasound meant toprobe deeply recessed abdominal organs.\nNormal results\nAs a diagnostic imaging technique, a normal abdom-\ninal ultrasound is one that indicates the absence of thesuspected condition that prompted the scan. For example,symptoms such as a persistent cough , labored breathing,\nand upper abdominal pain suggest the possibility of,among other things, an abdominal aortic aneurysm. Anultrasound scan that indicates the absence of an aneurysmwould rule out this life-threatening condition and point toother, less serious causes.\nAbnormal results\nBecause abdominal ultrasound imaging is generally\nundertaken to confirm a suspected condition, the resultsof a scan often will prove abnormal—that is they will\nconfirm the diagnosis, be it kidney stones, cirrhosis ofthe liver or an aortic aneurysm. At that point, appropriatemedical treatment as prescribed by a patient’s doctor is inorder. See the relevant disease and disorder entries in thisencyclopedia for more information.\nResources\nBOOKS\nHall, Rebecca. The Ultrasonic Handbook: Clinical, Etiologic\nand Pathologic Implications of Sonographic Findings.Philadelphia: Lippincott, 1993.\nKevles, Bettyann Holtzmann. Naked to the Bone: Medical\nImaging in the Twentieth Century. New Brunswick, NJ:\nRutgers University Press, 1997.\nKremkau, Frederick W. Diagnostic Ultrasound: Principles and\nInstruments. Philadelphia: W. B. Saunders Co., 1993.\nShtasel, Philip. Medical Tests and Diagnostic Procedures: A\nPatient’s Guide to Just What the Doctor Ordered. New\nYork: Harper & Row, 1991.\nTempkin, Betty Bates. Ultrasound Scanning: Principles and\nProtocols. Philadelphia: W. B. Saunders Co., 1993.\nThe Patient’s Guide to Medical Tests. Ed. Barry L. Zaret, et al.\nBoston: Houghton Mifflin, 1997.\nPERIODICALS\n“Ultrasound Detects Stomach Problems.” USA Today Maga-\nzine (October 1992): 5.\nFreundlich, Naomi. “Ultrasound: What’s Wrong with this Pic-\nture?” Business Week (15 September 1997): 84-5.\nMcDonagh, D. Brian. “Ultrasound: Unsung Medical Hero.”\nUSA Today Magazine (September 1996): 66-7.\nMurray, Maxine. “Basics of Ultrasonography.” Student British\nMedical Journal (August 1996): 269-72.\nTait, N., and J. M. Little. “The Treatment of Gallstones.”\nBritish Medical Journal (8 July 1995): 99-105.\nORGANIZATIONS\nAmerican College of Gastroenterology. 4900 B South 31st St.,\nArlington, V A 22206-1656. (703) 820-7400. <http://www.acg.gi.org>.\nAmerican Institute of Ultrasound in Medicine. 14750 Sweitzer\nLane, Suite 100, Laurel, MD 20707-5906. (800) 638-5352. <http://www."
#             ],
#             retrieval_context=None,
#             additional_metadata={
#                 "evolutions": ["Constrained"],
#                 "synthetic_input_quality": 1.0,
#                 "context_quality": 0.875,
#             },
#             comments=None,
#             tools_called=None,
#             expected_tools=None,
#             source_file="./synthesizer_data/encyclopedia.pdf",
#         ),
#         Golden(
#             input="I am experiencing a deepening voice and a more prominent Adam's apple. Could these be symptoms of adrenal virilism?",
#             actual_output=None,
#             expected_output="Based on your symptoms of a deepening voice and a more prominent Adam's apple, it is possible that these could be signs of adrenal virilism, particularly if there is an excess production of androgens. To make a more accurate diagnosis, I need to ask a few additional questions:\n\n1. Have you noticed any changes in your menstrual cycle, such as infrequent or absent periods?\n2. Are you experiencing any other symptoms, such as increased facial hair or rapid growth patterns?\n3. Do you have a family history of adrenal gland issues or related genetic conditions?\n\nThese details can help determine if further evaluation by an endocrinologist is needed, including hormone level tests to assess adrenal gland function.",
#             context=[
#                 "kidneys. The adrenal glands produce many hormones\nthat regulate body functions. These hormones includeandrogens, or male hormones. Androgens are producedin normal girls and women. Sometimes, one or both ofthe adrenal glands becomes enlarged or overactive, pro-ducing more than the usual amount of androgens. Theexcess androgens create masculine characteristics.\nCauses and symptoms\nIn infants and children, adrenal virilism is usually\nthe result of adrenal gland enlargement that is present atbirth. This is called congenital adrenal hyperplasia .\nThe cause is usually a genetic problem that leads tosevere enzyme deficiencies. In rare cases, adrenal viril-ism is caused by an adrenal gland tumor. The tumor canbe benign (adrenal adenoma) or cancerous (adrenal car-cinoma). Sometimes virilism is caused by a type oftumor on a woman’s ovary (arrhenoblastoma).\nNewborn girls with adrenal virilism have external\nsex organs that seem to be a mixture of male and femaleorgans (called female pseudohermaphrodism). Newbornboys with the disorder have enlarged external sex organs,and these organs develop at an abnormally rapid pace.\nChildren with congenital adrenal hyperplasia begin\ngrowing abnormally fast, but they stop growing earlierthan normal. Later in childhood, they are typically short-er than normal but have well-developed trunks.\nWomen with adrenal virilization may develop facial\nhair. Typically, their menstrual cycles are infrequent orabsent. They may also develop a deeper voice, a moreprominent Adam’s apple, and other masculine signs.\nDiagnosis\nEndocrinologists, doctors who specialize in the\ndiagnosis and treatment of glandular disorders, have themost expertise to deal with adrenal virilization. SomeKEY TERMS\nGlucocorticoid —A hormone produced by the\nadrenal gland; this hormone leads to an increasein blood sugar and creation of sugar molecules bythe liver.\nHydrocortisone —A hormone in the group of glu-\ncocorticoid hormones.\nPrednisone —A drug that functions as a glucocorti-\ncoid hormone.doctors who treat disorders of the internal organs\n(internists) and doctors who specialize in treating thereproductive system of women (gynecologists) may alsobe able to help patients with this disorder.\nDiagnosis involves performing many laboratory\ntests on blood samples from the patient. These tests mea-sure the concentration of different hormones. Differentabnormalities of the adrenal gland produce a differentpattern of hormonal abnormalities. These tests can alsohelp determine if the problem is adrenal or ovarian. If atumor is suspected, special x rays may be done to visual-ize the tumor in the body. Final diagnosis may depend onobtaining a tissue sample from the tumor (biopsy), andexamining it under a microscope in order to verify itscharacteristics.\nTreatment\nAdrenal virilism caused by adrenal hyperplasia is\ntreated with daily doses of a glucocorticoid. Usuallyprednisone is the drug of choice, but in infants hydrocor-tisone is usually given. Laboratory tests are usually need-ed from time to time to adjust the dosage. Girls withpseudohermaphrodism may require surgery to make theirexternal sex organs appear more normal. If a tumor iscausing the disorder, the treatment will depend on thetype and location of the tumor. Information about thetumor cell type and the spread of the tumor is used todecide the best kind of treatment for a particular patient.If the tumor is cancerous, the patient will require specialtreatment depending on how far the cancer has\nadvanced. Treatment can be a combination of surgery,medications used to kill cancer cells ( chemotherapy ),\nand x rays or other high energy rays used to kill cancercells ( radiation therapy ). Sometimes the doctor must\nremove the adrenal gland and the surrounding tissues. Ifthe tumor is benign, then surgically removing the tumormay be the best option.\nPrognosis\nOngoing glucocorticoid treatment usually controls\nadrenal virilism in cases of adrenal hyperplasia, but thereis no cure. If a cancerous tumor has caused the disorder,patients have a better prognosis if they have an early stageof cancer that is diagnosed quickly and has not spread.\nResources\nBOOKS\nHarrison’s Principles of Internal Medicine. Ed. Anthony S.\nFauci, et al. New York: McGraw-Hill, 1997.\nLittle, M., and D. C. Garrell. Encyclopedia of Health; The\nEndocrine System: The Healthy Body. Chelsea House,\n1990.\nG"
#             ],
#             retrieval_context=None,
#             additional_metadata={
#                 "evolutions": ["Constrained"],
#                 "synthetic_input_quality": 0.6,
#                 "context_quality": 0.875,
#             },
#             comments=None,
#             tools_called=None,
#             expected_tools=None,
#             source_file="./synthesizer_data/encyclopedia.pdf",
#         ),
#         Golden(
#             input="I've been experiencing severe nausea and drowsiness after taking zolpidem. Should I be concerned about a critical health risk? What should I do?",
#             actual_output=None,
#             expected_output="Thank you for sharing your symptoms. Severe nausea and drowsiness after taking zolpidem can be concerning, especially if they are accompanied by other symptoms like breathing problems or staggering, as these could indicate an overdose or dangerous interaction with other central nervous system (CNS) depressants. It is crucial to seek immediate emergency help as a precaution. Additionally, please ensure you are not consuming alcohol or other CNS depressants while on zolpidem. For ongoing management and to rule out any critical health risks, please consult with your physician promptly.",
#             context=[
#                 "Some people feel drowsy, dizzy, confused, light-\nheaded, or less alert the morning after they have takenzolpidem. The medicine may also cause clumsiness,unsteadiness, double vision, or other vision problems thenext day. For these reasons, anyone who takes thesedrugs should not drive, use machines or do anything elsethat might be dangerous until they have found out howzolpidem affects them.\nThis medicine has caused cause behavior changes in\nsome people, similar to those seen in people whosebehavior changes when they drink alcohol. Examplesinclude giddiness and rage. More extreme changes, suchas confusion, agitation, and hallucinations , also are pos-\nsible. Anyone who starts having strange or unusualthoughts or behavior while taking this medicine shouldget in touch with his or her physician.\nZolpidem and other sleep medicines may cause a\nspecial type of temporary memory loss, in which the per-son does not remember what happens between the timethey take the medicine and the time its effects wear off.This is usually not a problem, because people go to sleepright after taking the medicine and stay asleep until itseffects wear off. But it could be a problem for anyonewho has to wake up before getting a full night’s sleep(seven to eight hours). In particular, travelers should nottake this medicine on airplane flights of less than sevento eight hours.\nBecause zolpidem works work on the central ner-\nvous system, it may add to the effects of alcohol andother drugs that slow down the central nervous system,such as antihistamines, cold medicine, allergy medicine,medicine for seizures, tranquilizers, some pain relievers,\nand muscle relaxants . Zolpidem may also add to the\neffects of anesthetics, including those used for dentalprocedures. The combined effects of zolpidem and alco-hol or other CNS depressants (drugs that slow the centralnervous system) can be very dangerous, leading tounconsciousness or even death . People who take zolpi-\ndem should not drink alcohol and should check with theirphysicians before taking any other CNS depressant. Any-one who shows signs of an overdose or of the effects ofcombining zolpidem drugs with alcohol or other drugsshould have immediate emergency help. Warning signs\ninclude severe drowsiness, severe nausea or vomiting,breathing problems, and staggering.\nAnyone who takes zolpidem for more than one to\ntwo weeks should not stop taking it without first check-ing with a physician. Stopping the drug abruptly maycause rebound insomnia; increased difficulty fallingasleep for the first one of two nights after the drug hasbeen discontinued. In rare cases, withdrawal symptoms,such as vomiting, cramps, and unpleasant feelings mayoccur. Gradual tapering may be necessary.\nOlder people may be more sensitive to the effects of\nzolpidem. This may increase the chance of side effects,such as confusion, and may also increase the risk offalling.\nIn people with breathing problems, zolpidem may\nworsen the symptoms.\nSpecial conditions\nPeople with certain other medical conditions or who\nare taking certain other medicines can have problems ifthey take zolpidem. Before taking this medicine, be sureto let the physician know about any of these conditions:\nALLERGIES. Anyone who has had unusual reactions\nto zolpidem in the past should let his or her physicianknow before taking the drugs again. The physicianshould also be told about any allergies to foods, dyes,\npreservatives, or other substances.\nPREGNANCY. Women who are pregnant or who may\nbecome pregnant should check with their physiciansabout the safety of using zolpidem during pregnancy .\nBREASTFEEDING. Women who are breastfeeding\nshould check with their physicians before using zolpi-dem.\nOTHER MEDICAL CONDITIONS. Before using zolpi-\ndem, people with any of these medical problems shouldmake sure their physicians are aware of their conditions:\n• chronic lung diseases ( emphysema ,asthma , or chron-\nic bronchitis)\nGALE ENCYCLOPEDIA OF MEDICINE 2 283Anti-insomnia drugs\nAnti-Insomnia Drugs\nBrand Name (Generic Name) Possible Common Side Effects Include:\nAmbien (zolpidem tartrate) Daytime drowsiness, dizziness, headache\nDalmane (flurazepam hydrochloride) Decreased coordination, lightheadedness, dizzinessDoral (quazepam) Daytime drowsiness, headache, dry mouth, fatigueHalcion (triazolam) Decreased coordination, chest pain, memory impairmentProSom (estazolam) Dizz"
#             ],
#             retrieval_context=None,
#             additional_metadata={
#                 "evolutions": ["Reasoning"],
#                 "synthetic_input_quality": 0.7,
#                 "context_quality": 0.875,
#             },
#         ),
#     ]
# )
